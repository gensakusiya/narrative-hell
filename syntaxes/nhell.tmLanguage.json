{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Narrative Hell",
  "scopeName": "source.nhell",
  "patterns": [
    {
      "include": "#event-header"
    },
    {
      "include": "#metadata"
    },
    {
      "include": "#title"
    },
    {
      "include": "#choice"
    },
    {
      "include": "#effects"
    },
    {
      "include": "#flow-control"
    },
    {
      "include": "#dialogue"
    },
    {
      "include": "#comments"
    },
    {
      "include": "#variables"
    }
  ],
  "repository": {
    "event-header": {
      "patterns": [
        {
          "name": "entity.name.section.nhell",
          "match": "^(===)\\s+([\\w_]+)\\s+(===)\\s*$",
          "captures": {
            "1": { "name": "punctuation.definition.heading.begin.nhell" },
            "2": { "name": "entity.name.function.event.nhell" },
            "3": { "name": "punctuation.definition.heading.end.nhell" }
          }
        }
      ]
    },
    "metadata": {
      "patterns": [
        {
          "name": "meta.metadata.nhell",
          "match": "^(id|author|tags|version|description):\\s*(.+)$",
          "captures": {
            "1": { "name": "keyword.other.metadata.nhell" },
            "2": { "name": "string.unquoted.metadata.nhell" }
          }
        }
      ]
    },
    "title": {
      "patterns": [
        {
          "name": "markup.heading.nhell",
          "match": "^(#)\\s+(.+)$",
          "captures": {
            "1": { "name": "punctuation.definition.heading.nhell" },
            "2": { "name": "entity.name.section.title.nhell" }
          }
        }
      ]
    },
    "dialogue": {
      "patterns": [
        {
          "name": "meta.dialogue.nhell",
          "match": "^(\\w+):\\s*\"([^\"]*)\"\\s*$",
          "captures": {
            "1": { "name": "entity.name.type.character.nhell" },
            "2": { "name": "string.quoted.dialogue.nhell" }
          }
        },
        {
          "name": "meta.dialogue.nhell",
          "match": "^(\\w+):\\s*'([^']*)'\\s*$",
          "captures": {
            "1": { "name": "entity.name.type.character.nhell" },
            "2": { "name": "string.quoted.dialogue.nhell" }
          }
        },
        {
          "name": "meta.dialogue.unquoted.nhell",
          "match": "^(\\w+):\\s+(.+)$",
          "captures": {
            "1": { "name": "entity.name.type.character.nhell" },
            "2": { "name": "string.unquoted.dialogue.nhell" }
          }
        }
      ]
    },
    "choice": {
      "patterns": [
        {
          "name": "meta.choice.nhell",
          "begin": "^(\\*)\\s*(\\[)",
          "end": "(\\])",
          "beginCaptures": {
            "1": { "name": "punctuation.definition.list.nhell" },
            "2": { "name": "punctuation.definition.choice.begin.nhell" }
          },
          "endCaptures": {
            "1": { "name": "punctuation.definition.choice.end.nhell" }
          },
          "contentName": "string.choice.text.nhell",
          "patterns": [
            {
              "name": "constant.character.escape.nhell",
              "match": "\\\\."
            }
          ]
        }
      ]
    },
    "effects": {
      "patterns": [
        {
          "name": "meta.effect.numeric.nhell",
          "match": "^\\s*(~)\\s+(\\w+)\\s*([+-]?\\d+)\\s*$",
          "captures": {
            "1": { "name": "keyword.operator.effect.nhell" },
            "2": { "name": "variable.parameter.nhell" },
            "3": { "name": "constant.numeric.nhell" }
          }
        },
        {
          "name": "meta.effect.flag.nhell",
          "match": "^\\s*(~)\\s+(flag|promise|set):\\s*(\\w+)\\s*$",
          "captures": {
            "1": { "name": "keyword.operator.effect.nhell" },
            "2": { "name": "storage.type.effect.nhell" },
            "3": { "name": "variable.other.flag.nhell" }
          }
        }
      ]
    },
    "flow-control": {
      "patterns": [
        {
          "name": "meta.flow.goto.nhell",
          "match": "(->)\\s+(\\w+)",
          "captures": {
            "1": { "name": "keyword.operator.arrow.nhell" },
            "2": { "name": "entity.name.label.nhell" }
          }
        },
        {
          "name": "keyword.control.nhell",
          "match": "\\b(END|GAME_OVER|START)\\b"
        }
      ]
    },
    "comments": {
      "patterns": [
        {
          "name": "comment.line.double-slash.nhell",
          "match": "//.*$"
        },
        {
          "name": "comment.block.nhell",
          "begin": "/\\*",
          "end": "\\*/",
          "patterns": [
            {
              "name": "comment.block.nhell",
              "match": "."
            }
          ]
        }
      ]
    },
    "variables": {
      "patterns": [
        {
          "name": "variable.language.state.nhell",
          "match": "\\b(family|budget|stress|mood|time|job_security)\\b"
        },
        {
          "name": "constant.numeric.nhell",
          "match": "\\b\\d+\\b"
        },
        {
          "name": "constant.language.boolean.nhell",
          "match": "\\b(true|false)\\b"
        },
        {
          "name": "variable.other.state.nhell",
          "match": "\\{(\\w+)\\}",
          "captures": {
            "1": { "name": "variable.other.interpolation.nhell" }
          }
        }
      ]
    }
  }
}
